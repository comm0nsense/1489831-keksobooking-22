{"version":3,"sources":["webpack://keksobooking/./js/form.js","webpack://keksobooking/./js/card.js","webpack://keksobooking/./js/filter.js","webpack://keksobooking/./js/map.js","webpack://keksobooking/./js/validate-form.js","webpack://keksobooking/./js/show-modal.js","webpack://keksobooking/./js/file-upload.js","webpack://keksobooking/./js/submit-form.js","webpack://keksobooking/./js/main.js","webpack://keksobooking/./js/api.js"],"names":["adForm","document","querySelector","adFormAddress","adFormHeader","adFormElements","querySelectorAll","resetAdFormButton","readOnly","typeMap","Map","newCardTemplate","content","ANY_FILTER","priceToRange","low","MIN","MAX","middle","high","mapFilters","housingFilters","mapFeatures","housingType","housingPrice","housingRooms","housingGuests","TokyoCenterCoordinates","X","Y","DefaultCoordinates","toFixed","map","L","mainMarkerIcon","icon","iconUrl","iconSize","iconAnchor","MarkerParameters","openstreetMap","on","classList","remove","disabled","forEach","formElement","value","setView","lat","lng","tileLayer","attribution","addTo","mainMarker","marker","draggable","evt","target","getLatLng","markerIcon","markers","createMarkers","ads","ad","location","bindPopup","card","newCard","cloneNode","textContent","offer","title","address","price","get","type","rooms","guests","checkin","checkout","featuresList","innerHTML","features","length","feature","addFeature","createElement","add","appendChild","description","photosList","photo","offerPhotos","photos","offerPhoto","img","src","author","avatar","createCard","keepInView","push","createMarker","slicedAds","renderMarkers","slice","adType","adPrice","adRooms","adGuests","adFeatures","filterType","filterRooms","filterGuests","filterPrice","filterFeatures","i","includes","addEventListener","_","debounce","id","Array","from","slicedFilteredAds","filter","setFilterHandler","TypeToPrice","palace","flat","house","bungalow","NotForGuestType","adTitle","roomNumber","capacity","timeIn","timeOut","roomToGuest","setCustomValidity","reportValidity","capacityOptions","roomOptions","getOptionSelected","options","result","option","selected","ESC_KEYDOWN","modalContainer","successModalTemplate","errorModalTemplate","newSuccessModal","style","zIndex","newErrorModal","showModal","modal","onModalEscKeydown","key","closeModal","removeEventListener","append","FILE_TYPES","avatarChooser","avatarPreview","photoChooser","photoUpload","photoPreview","display","maxWidth","height","setFileUploadHandler","fileChooser","preview","file","files","fileName","name","toLowerCase","matches","some","it","endsWith","reader","FileReader","readAsDataURL","setDefaults","reset","setLatLng","adTypeSelected","adTypeSelectedPrice","placeholder","resetDefaultAdPrice","removeAttribute","preventDefault","mapFilterId","titleLength","min","timeSelected","async","url","response","fetch","ok","json","Error","getData","then","catch","err","message","alertContainer","position","left","top","right","padding","fontSize","textAlign","backgroundColor","body","setTimeout","showAlert","method","postData","FormData"],"mappings":"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","file":"main.bundle.js","sourcesContent":["import { DefaultCoordinates } from './map.js'\n\n//Форма и поля\nconst adForm = document.querySelector('.ad-form');\nconst adFormAddress = adForm.querySelector('#address');\nconst adFormHeader = adForm.querySelector('.ad-form-header');\nconst adFormElements = adForm.querySelectorAll('.ad-form__element');\n\n//Кнопка сброса формы\nconst resetAdFormButton = adForm.querySelector('.ad-form__reset');\n\nconst disableForm = () => {\n  adForm.classList.add('ad-form--disabled');\n  adFormHeader.disabled = true;\n  adFormElements.forEach(formElement => formElement.disabled = true);\n};\n\nconst enableForm = () => {\n  adForm.classList.remove('ad-form--disabled');\n  adFormHeader.disabled = false;\n  adFormElements.forEach(formElement => formElement.disabled = false);\n  adFormAddress.value = `${DefaultCoordinates.X}, ${DefaultCoordinates.Y}`;\n};\n\nadFormAddress.readOnly = true;\n\n\n//Сброс формы и фильтров\nconst resetForm = () => {\n  adForm.reset();\n  adFormAddress.value = `${DefaultCoordinates.X}, ${DefaultCoordinates.Y}`;\n};\n\nexport {\n  enableForm,\n  disableForm,\n  adFormAddress,\n  adForm,\n  resetAdFormButton,\n  resetForm\n}\n","// Создание мапа по типам жилья\nconst typeMap = new Map([\n  ['palace', 'Дворец' ],\n  ['flat', 'Квартира'],\n  ['house', 'Дом'],\n  ['bungalow', 'Бунгало'],\n]);\n\n//Шаблон карточки\nconst cardTemplate = document.querySelector('#card').content;\nconst newCardTemplate = cardTemplate.querySelector('.popup');\n\n//Создаем карточку\nconst createCard = (card) => {\n  const newCard = newCardTemplate.cloneNode(true);\n  newCard.querySelector('.popup__title').textContent = card.offer.title;\n  newCard.querySelector('.popup__text--address').textContent = card.offer.address;\n  newCard.querySelector('.popup__text--price').textContent = `${card.offer.price} ₽/ночь`;\n  newCard.querySelector('.popup__type').textContent = typeMap.get(card.offer.type);\n  newCard.querySelector('.popup__text--capacity').textContent = `${card.offer.rooms} комнаты для ${card.offer.guests} гостей`;\n  newCard.querySelector('.popup__text--time').textContent = `Заезд после ${card.offer.checkin}, выезд до ${card.offer.checkout}`;\n\n  //Создаем список features\n  const featuresList = newCard.querySelector('.popup__features');\n  featuresList.innerHTML = ''\n  const features = card.offer.features;\n\n  if (features.length === 0) {\n    featuresList.remove();\n  }\n\n  features.forEach((feature) => {\n    const addFeature = document.createElement('li');\n    addFeature.classList.add('popup__feature');\n    addFeature.classList.add(`popup__feature--${feature}`);\n    featuresList.appendChild(addFeature);\n  });\n\n  newCard.querySelector('.popup__description').textContent = card.offer.description;\n\n  //Созадем фотографии жилья\n  const photosList =  newCard.querySelector('.popup__photos');\n  const photo = photosList.querySelector('.popup__photo');\n  const offerPhotos =  card.offer.photos;\n  photo.remove();\n\n  if (offerPhotos.length === 0) {\n    photosList.remove();\n  }\n\n  offerPhotos.forEach((offerPhoto) => {\n    const img = photo.cloneNode(false);\n    img.src = offerPhoto;\n    photosList.appendChild(img);\n  });\n\n  newCard.querySelector('.popup__avatar').src = card.author.avatar;\n\n  return newCard;\n}\n\nexport { createCard };\n","/* global _:readonly */\nimport { createMarkers, removeMarkers } from './map.js'\n\nconst MAX_ADS_COUNT = 10;\nconst ANY_FILTER = 'any';\nconst RERENDER_DELAY = 500;\n\nconst priceToRange = {\n  low: {\n    MIN: 0,\n    MAX: 10000,\n  },\n  middle: {\n    MIN: 10000,\n    MAX: 50000,\n  },\n  high: {\n    MIN: 50000,\n    MAX: 999999,\n  },\n};\n\n//Фильтрация объявлений\nconst mapFilters = document.querySelector('.map__filters');\nconst housingFilters = mapFilters.querySelectorAll('.map__filter');\nconst mapFeatures = mapFilters.querySelector('.map__features');\n\nconst housingType = mapFilters.querySelector('#housing-type');\nconst housingPrice = mapFilters.querySelector('#housing-price');\nconst housingRooms = mapFilters.querySelector('#housing-rooms');\nconst housingGuests = mapFilters.querySelector('#housing-guests');\n\n//фильтрация объявлений - активация\nconst disableFilters = () => {\n  mapFilters.classList.add('map__filters--disabled');\n  housingFilters.forEach(mapFilterId => mapFilterId.disabled = true);\n  mapFeatures.disabled = true;\n};\n\n//деактивация фильтров\nconst enableFilters = () => {\n  mapFilters.classList.remove('map__filters--disabled');\n  housingFilters.forEach(mapFilterId => mapFilterId.disabled = false);\n  mapFeatures.disabled = false;\n};\n\n//Сброс фильтров\nconst resetFilters = () => {\n  mapFilters.reset();\n};\n\nconst setFilterHandler = (ads) => {\n  //получаем текущие значение фильтров\n  let adType = housingType.value;\n  let adPrice = housingPrice.value;\n  let adRooms = housingRooms.value;\n  let adGuests = housingGuests.value;\n  let adFeatures = [];\n\n  //Настройка фильтровки для каждого фильтра\n  const filterType = ad => adType === ANY_FILTER ? true : ad.offer.type === adType;\n  const filterRooms = ad => adRooms === ANY_FILTER ? true : ad.offer.rooms === +adRooms;\n  const filterGuests = ad => (adGuests === ANY_FILTER ? true : ad.offer.guests === +adGuests);\n  const filterPrice = ad => adPrice === ANY_FILTER ? true :\n    priceToRange[adPrice].MIN <= ad.offer.price && priceToRange[adPrice].MAX >= ad.offer.price;\n\n  const filterFeatures = (ad) => {\n    for (let i = 0; i <= adFeatures.length - 1; i++) {\n      if (!ad.offer.features.includes(adFeatures[i])) {\n        return false;\n      }\n    }\n    return true;\n  };\n\n\n  const onFilterChange = (evt) => {\n    //изменяем значение при клике на фильтр\n    if (evt.target.id === housingType.id) {\n      adType = evt.target.value;\n    } else if (evt.target.id === housingPrice.id) {\n      adPrice = evt.target.value;\n    } else if (evt.target.id === housingRooms.id) {\n      adRooms = evt.target.value;\n    } else if (evt.target.id === housingGuests.id) {\n      adGuests = evt.target.value;\n    } else if (evt.target.id === ('filter-' + evt.target.value)) {\n      adFeatures = Array.from(mapFeatures.querySelectorAll('input:checked')).map((feature) => feature.value);\n    }\n\n    const filteredAds = ads\n      .filter(filterType)\n      .filter(filterRooms)\n      .filter(filterGuests)\n      .filter(filterPrice)\n      .filter(filterFeatures);\n\n    const slicedFilteredAds = filteredAds.slice(0, MAX_ADS_COUNT);\n\n    removeMarkers();\n    createMarkers(slicedFilteredAds);\n  }\n\n  mapFilters.addEventListener('change', _.debounce(onFilterChange, RERENDER_DELAY));\n};\n\nexport {\n  enableFilters,\n  disableFilters,\n  mapFilters,\n  setFilterHandler,\n  resetFilters,\n  MAX_ADS_COUNT\n}\n","/* global L:readonly */\nimport { enableForm, adFormAddress } from './form.js';\nimport { createCard } from './card.js';\nimport { setFilterHandler, MAX_ADS_COUNT } from './filter.js'\n\nconst COORDINATE_DECIMALS_COUNT = 5;\nconst MAP_SCALE = 10;\n\nconst OpenStreetMapDetails = {\n  URL: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',\n  COPYRIGHT: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\n};\n\nconst MarkerParameters = {\n  MAIN_MARKER_ICON_URL: 'img/main-pin.svg',\n  MARKER_ICON_URL: 'img/pin.svg',\n  WIDTH: 52,\n  HEIGHT: 52,\n};\n\nconst TokyoCenterCoordinates = {\n  X: 35.6804,\n  Y: 139.759,\n};\n\nconst DefaultCoordinates = {\n  X: TokyoCenterCoordinates.X.toFixed(COORDINATE_DECIMALS_COUNT),\n  Y: TokyoCenterCoordinates.Y.toFixed(COORDINATE_DECIMALS_COUNT),\n};\n\nconst map = L.map('map-canvas')\n\n//Параментры внешнего вида главной метки\nconst mainMarkerIcon = L.icon({\n  iconUrl: MarkerParameters.MAIN_MARKER_ICON_URL,\n  iconSize: [MarkerParameters.WIDTH, MarkerParameters.HEIGHT],\n  iconAnchor: [MarkerParameters.WIDTH / 2, MarkerParameters.HEIGHT],\n});\n\n//Рисуем карту\nconst getMap = () => {\n  map\n    .on('load', () => {\n      enableForm();\n    })\n    .setView({\n      lat: DefaultCoordinates.X,\n      lng: DefaultCoordinates.Y,\n    }, MAP_SCALE);\n\n  L.tileLayer(\n    OpenStreetMapDetails.URL,\n    {\n      attribution: OpenStreetMapDetails.COPYRIGHT,\n    },\n  ).addTo(map);\n\n  return map;\n};\n\n//инициализация карты + активация формы\n// const openstreetMap = getMap();\nconst openstreetMap = getMap;\n\n\n//сброс карты в исходное состояние\nconst resetMapView = () => {\n  openstreetMap().setView({\n    lat: DefaultCoordinates.X,\n    lng: DefaultCoordinates.Y,\n  }, MAP_SCALE);\n}\n\n\n//Рисуем Главную метку\nconst mainMarker = L.marker(\n  {\n    lat: DefaultCoordinates.X,\n    lng: DefaultCoordinates.Y,\n  },\n  {\n    draggable: true,\n    icon: mainMarkerIcon,\n  },\n).addTo(map);\n\n//Перемещение главное метки\nmainMarker.on('move', (evt) => {\n  const lat = evt.target.getLatLng().lat.toFixed(COORDINATE_DECIMALS_COUNT);\n  const lng = evt.target.getLatLng().lng.toFixed(COORDINATE_DECIMALS_COUNT);\n  adFormAddress.value = `${lat}, ${lng}`;\n});\n\nconst resetMainMarkerLatLng = () => {\n  mainMarker.setLatLng([DefaultCoordinates.X, DefaultCoordinates.Y]);\n}\n\n//Параментры внешнего вида меток объявлений\nconst markerIcon = L.icon({\n  iconUrl: MarkerParameters.MARKER_ICON_URL,\n  iconSize: [MarkerParameters.WIDTH, MarkerParameters.HEIGHT],\n  iconAnchor: [MarkerParameters.WIDTH / 2, MarkerParameters.HEIGHT],\n});\n\nconst markers = [];\n\n//Рисуем обычную метку для объявлений\nconst createMarker = (ad) => {\n  const marker = L.marker(\n    {\n      lat: ad.location.lat,\n      lng: ad.location.lng,\n    },\n    {\n      icon: markerIcon,\n    },\n  );\n\n  marker\n    .addTo(map)\n    .bindPopup(\n      createCard(ad),\n      {\n        keepInView: true,\n      },\n    );\n\n  markers.push(marker);\n};\n\nconst createMarkers = (ads) => {\n  ads.forEach(ad => {\n    createMarker(ad);\n  });\n};\n\nconst removeMarkers = () => {\n  markers.forEach(marker => {\n    marker.remove();\n  });\n};\n\n\nlet slicedAds = [];\n\n//отрисовка маркеров\nconst renderMarkers = (ads) => {\n  slicedAds = ads.slice(0, MAX_ADS_COUNT);\n  createMarkers(slicedAds);\n  setFilterHandler(ads);\n}\n\nexport {\n  getMap,\n  DefaultCoordinates,\n  createMarkers,\n  removeMarkers,\n  MAP_SCALE,\n  resetMainMarkerLatLng,\n  renderMarkers,\n  slicedAds,\n  resetMapView,\n  openstreetMap\n}\n","import { adForm} from './form.js';\n\nconst PRICE_PER_NIGHT_MAX = 1000000;\n\nconst TitleLength = {\n  MIN: 30,\n  MAX: 100,\n}\n\nconst TypeToPrice = {\n  palace: 10000,\n  flat: 1000,\n  house: 5000,\n  bungalow: 0,\n};\n\nconst NotForGuestType = {\n  ROOM: '100',\n  GUEST: '0',\n}\n\nconst adTitle = adForm.querySelector('#title');\nconst roomNumber = adForm.querySelector('#room_number');\nconst capacity = adForm.querySelector('#capacity');\nconst adPrice = adForm.querySelector('#price');\nconst adType = adForm.querySelector('#type');\nconst timeIn = adForm.querySelector('#timein');\nconst timeOut = adForm.querySelector('#timeout');\n\n//Cброс цены по выбранному типу жилья\nconst resetDefaultAdPrice = () => {\n  const adTypeSelected = adType.value;\n  const adTypeSelectedPrice = TypeToPrice[adTypeSelected]\n  adPrice.placeholder = `${adTypeSelectedPrice}`;\n};\n\n// Подстановка мин стоимости по типу жилья\nconst updateOfferPrice = () => {\n  adPrice.placeholder = TypeToPrice[adType.value];\n  adPrice.min = TypeToPrice[adType.value];\n};\n\n// Подстановка времени выезда по вермени заезда\nconst updateCheckTime = (evt) => {\n  const timeSelected = evt.target.value;\n  switch (evt.target) {\n    case timeIn:\n      timeOut.value = timeSelected;\n      break;\n    case timeOut:\n      timeIn.value = timeSelected;\n      break;\n  }\n};\n\n//Проверка соответствия комнаты - гости\nconst roomToGuest = (rooms, guests) => {\n  if (rooms === NotForGuestType.ROOM && guests !== NotForGuestType.GUEST) {\n    capacity.setCustomValidity('Не для гостей');\n  } else if (guests === NotForGuestType.GUEST && rooms !== NotForGuestType.ROOM) {\n    capacity.setCustomValidity(`${NotForGuestType.ROOM} комнат`);\n  } else if (rooms < guests) {\n    capacity.setCustomValidity(`Гостей (${guests}) больше чем свободных комнат (${rooms})`);\n  } else {\n    capacity.setCustomValidity('');\n  }\n\n  capacity.reportValidity();\n};\n\nconst capacityOptions = capacity.querySelectorAll('option');\nconst roomOptions = roomNumber.querySelectorAll('option');\n\nconst getOptionSelected = (options) => {\n  let result = 0;\n\n  options.forEach((option) => {\n    if (option.selected) {\n      result = option.value;\n    }\n  })\n\n  return result;\n};\n\n\nconst checkRooms = (evt) => {\n  const rooms = evt.target.value;\n  const guests = getOptionSelected(capacityOptions);\n  roomToGuest(rooms, guests);\n};\n\nconst checkGuests = (evt) => {\n  const guests = evt.target.value;\n  const rooms = getOptionSelected(roomOptions);\n  roomToGuest(rooms, guests);\n};\n\n\n//Проверка заголовка объявления\nconst checkTitleInput = () => {\n  const titleLength = adTitle.value.length;\n\n  if (titleLength < TitleLength.MIN) {\n    adTitle.setCustomValidity(`Заголовок должен состоять минимум из ${TitleLength.MIN} символов`);\n  } else if (titleLength >= TitleLength.MAX) {\n    adTitle.setCustomValidity(`Заголовок не должен превышать ${TitleLength.MAX} символов`);\n  } else {\n    adTitle.setCustomValidity('');\n  }\n  adTitle.reportValidity();\n};\n\n\n//Проверка цены предложения\nconst checkOfferPrice = () => {\n  const price = adPrice.value;\n  const minPrice = TypeToPrice[adType.value];\n\n  if (price < minPrice) {\n    adPrice.setCustomValidity(`Стоимость не должна быть ниже ${TypeToPrice[adType.value]}`);\n  } else if (price > PRICE_PER_NIGHT_MAX) {\n    adPrice.setCustomValidity(`Стоиомость не должна превышать ${PRICE_PER_NIGHT_MAX}`);\n  } else {\n    adPrice.setCustomValidity('');\n  }\n  adPrice.reportValidity();\n};\n\n\n//Обработчики событий\nconst setFormHandlers = () => {\n  adTitle.addEventListener('input', checkTitleInput);\n  adPrice.addEventListener('input', checkOfferPrice);\n  capacity.addEventListener('input', checkGuests);\n  roomNumber.addEventListener('input', checkRooms);\n  adForm.addEventListener('input', updateOfferPrice);\n  adForm.addEventListener('input', updateCheckTime);\n};\n\nexport { setFormHandlers, resetDefaultAdPrice }\n","const ESC_KEYDOWN = ['Escape', 'Esc'];\nconst ALERT_SHOW_TIME = 5000;\n\n//Контейнер для сообщения\nconst modalContainer = document.querySelector('main');\n\n//Темплейты сообщений\nconst successModalTemplate = document.querySelector('#success')\n  .content\n  .querySelector('.success');\n\nconst errorModalTemplate = document.querySelector('#error')\n  .content\n  .querySelector('.error');\n\n//Создем сообщение на основании темлейта\nconst newSuccessModal = successModalTemplate.cloneNode(true);\nnewSuccessModal.style.zIndex = '1000';\nconst newErrorModal = errorModalTemplate.cloneNode(true);\nnewErrorModal.style.zIndex = '1000';\n\nconst showModal = (modal) => {\n  const onModalEscKeydown = (evt) => {\n    if (evt.key === (ESC_KEYDOWN[0] || ESC_KEYDOWN[1])) {\n      closeModal();\n    }\n  };\n\n  const closeModal = () => {\n    modal.remove();\n    modal.removeEventListener('click', closeModal);\n    document.removeEventListener('keydown', onModalEscKeydown);\n  }\n\n  modalContainer.append(modal);\n  modal.addEventListener('click', closeModal);\n  document.addEventListener('keydown', onModalEscKeydown);\n};\n\n/**\n *\n * @param {*} message\n */\n\nconst showAlert = (message) => {\n  const alertContainer = document.createElement('div');\n  alertContainer.style.zIndex = 100;\n  alertContainer.style.position = 'absolute';\n  alertContainer.style.left = 0;\n  alertContainer.style.top = 0;\n  alertContainer.style.right = 0;\n  alertContainer.style.padding = '10px 3px';\n  alertContainer.style.fontSize = '30px';\n  alertContainer.style.textAlign = 'center';\n  alertContainer.style.backgroundColor = 'red';\n\n  alertContainer.textContent = message;\n\n  document.body.append(alertContainer);\n\n  setTimeout(() => {\n    alertContainer.remove();\n  }, ALERT_SHOW_TIME);\n};\n\nexport { newSuccessModal, newErrorModal, showModal, showAlert };\n","const FILE_TYPES = ['gif', 'jpg', 'jpeg', 'png'];\n\nconst avatarChooser = document.querySelector('.ad-form__field input[type=file]');\nconst avatarPreview = document.querySelector('.ad-form-header__preview img');\nconst AVATAR_PREVIEW_SRC = 'img/muffin-grey.svg';\n\nconst photoChooser = document.querySelector('.ad-form__upload input[type=file]');\nconst photoUpload = document.querySelector('.ad-form__photo');\n\nconst photoPreview = document.createElement('img');\nphotoPreview.style.display = 'flex';\nphotoPreview.style.maxWidth = '100%';\nphotoPreview.style.height = 'auto';\nphotoUpload.append(photoPreview);\n\nconst setFileUploadHandler = (fileChooser, preview, FILE_TYPES) => {\n  const onFileUpload = (evt) => {\n    const file = evt.target.files[0];\n    const fileName = file.name.toLowerCase();\n    const matches = FILE_TYPES.some((it) => {\n      return fileName.endsWith(it);\n    });\n\n    if (matches) {\n      fileChooser.setCustomValidity('');\n      const reader = new FileReader();\n      reader.addEventListener('load', () => {\n        preview.src = reader.result;\n      });\n      reader.readAsDataURL(file);\n    } else if (!matches) {\n      fileChooser.setCustomValidity('Можно загружать изображения в следующих форматах: *.gif, *.jpg, *.jpeg, *.png');\n    }\n    fileChooser.reportValidity();\n  }\n  fileChooser.addEventListener('change', onFileUpload)\n};\n\n//Загрузка аватарки\nconst fileUpload = () => {\n  setFileUploadHandler(avatarChooser, avatarPreview, FILE_TYPES);\n  setFileUploadHandler(photoChooser, photoPreview, FILE_TYPES)\n}\n\nconst clearPhotoUpload = () => {\n  photoPreview.removeAttribute('src');\n};\n\nconst clearFileSrc = (preview, src) => {\n  preview.src = src;\n};\n\nexport { clearFileSrc, avatarPreview, AVATAR_PREVIEW_SRC, clearPhotoUpload, fileUpload }\n","import { resetMapView, resetMainMarkerLatLng, createMarkers, slicedAds } from './map.js'\nimport { resetForm, resetAdFormButton } from './form.js'\nimport { resetFilters} from './filter.js'\nimport {resetDefaultAdPrice } from './validate-form.js'\nimport { newSuccessModal, newErrorModal, showModal } from './show-modal.js';\nimport { adForm } from './form.js';\nimport { postData } from './api.js';\nimport { clearFileSrc, avatarPreview, AVATAR_PREVIEW_SRC, clearPhotoUpload } from './file-upload.js'\n\nconst POST_DATA_URL = 'https://22.javascript.pages.academy/keksobooking';\n\nconst setDefaults = () => {\n  resetMapView();\n  resetForm();\n  resetFilters();\n  resetMainMarkerLatLng();\n  resetDefaultAdPrice();\n  createMarkers(slicedAds);\n  clearFileSrc(avatarPreview, AVATAR_PREVIEW_SRC);\n  clearPhotoUpload();\n};\n\n//Сброс страницы до состояния по умолчанию по нажатию кнопки Очистить\nresetAdFormButton.addEventListener('click', (evt) => {\n  evt.preventDefault();\n  setDefaults()\n});\n\n//Обработчик события Отправки формы\nconst submitAdForm = () => {\n  adForm.addEventListener('submit', (evt) => {\n    evt.preventDefault();\n\n    const formData = new FormData(evt.target);\n    postData(POST_DATA_URL, formData)\n      .then(() => {\n        showModal(newSuccessModal);\n        setDefaults();\n      })\n      .catch(() => {\n        showModal(newErrorModal)\n      });\n  });\n};\n\nexport {\n  setDefaults,\n  submitAdForm\n}\n","import { renderMarkers, openstreetMap } from './map.js';\nimport { disableForm } from './form.js';\nimport { setFormHandlers } from './validate-form.js';\nimport { getData} from './api.js';\nimport { showAlert } from './show-modal.js';\nimport { disableFilters, enableFilters } from './filter.js';\nimport { submitAdForm } from './submit-form.js';\nimport { fileUpload} from './file-upload.js';\n// import './file-upload.js';\n\nconst GET_DATA_URL = 'https://22.javascript.pages.academy/keksobooking/data';\n\n//Делаем страницу неактивной\ndisableForm();\ndisableFilters();\n\n//инициализация карты + активация формы\nopenstreetMap();\n\n//Обработчики формы\nsetFormHandlers();\n\n//Загружаем данные по объявлениям и включаем фильтрацию\ngetData(GET_DATA_URL)\n  .then((ads) => {\n    enableFilters();\n    renderMarkers(ads);\n  })\n  .catch(err => showAlert(err.message));\n\n//Запускаем отправку формы\nsubmitAdForm();\n\n//Подключаем модуль загрузки аватарки и фоток\nfileUpload();\n","// Полчучаем данные об объявлениях с сервера\nconst getData = async (url) => {\n  const response = await fetch(url);\n\n  if (response.ok) {\n    const data = await response.json();\n    return data;\n  } else {\n    throw new Error('Не удается зарузить данные. Перезагрузите страницу.');\n  }\n\n};\n\n//Отпралвение данные из формы на сервер\nconst postData = async (url, body) => {\n  const response = await fetch(\n    url,\n    {\n      method: 'POST',\n      body,\n    })\n\n  if (!response.ok) {\n    throw new Error('Rejected: Не удалось отправить данные');\n  }\n};\n\nexport { getData, postData }\n"],"sourceRoot":""}